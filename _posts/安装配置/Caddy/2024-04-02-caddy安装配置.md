---
layout: post
title: Caddyå®‰è£…é…ç½®
date: 2024-04-02 23:05 +0800
categories:
- å®‰è£…é…ç½®
- Caddy
tags:
- Caddy
---
Caddyæ˜¯ä¸€æ¬¾åŸºäºGoè¯­è¨€ç¼–å†™çš„å¼ºå¤§ä¸”å¯æ‰©å±•çš„å¹³å°ï¼Œå¯ä»¥ç»™ä½ çš„ç«™ç‚¹ã€æœåŠ¡å’Œåº”ç”¨ç¨‹åºæä¾›æœåŠ¡ã€‚

[ğŸ”—å®˜ç½‘](https://caddyserver.com/)  
[ğŸ”—GitHub](https://github.com/caddyserver/caddy)  
[ğŸ”—ä¸­æ–‡æ–‡æ¡£](https://caddy2.dengxiaolong.com/docs/)  
# å®‰è£…
```zsh
sudo apt install -y debian-keyring debian-archive-keyring apt-transport-https
curl -1sLf 'https://dl.cloudsmith.io/public/caddy/stable/gpg.key' | sudo gpg --dearmor -o /usr/share/keyrings/caddy-stable-archive-keyring.gpg
curl -1sLf 'https://dl.cloudsmith.io/public/caddy/stable/debian.deb.txt' | sudo tee /etc/apt/sources.list.d/caddy-stable.list
sudo apt update
sudo apt install caddy
```
{: file="Debianã€Ubuntuã€Raspbian"}

```zsh
dnf install 'dnf-command(copr)'
dnf copr enable @caddy/caddy
dnf install caddy
```
{: file="Fedora æˆ– RHEL/CentOS 8ï¼š"}
```zsh
yum install yum-plugin-copr
yum copr enable @caddy/caddy
yum install caddy
```
{: file="RHEL/CentOS 7ï¼š"}

```zsh
docker pull caddy
```
{: file="Docker"}

# HTTPS
> Caddyé»˜è®¤å¯¹æ‰€æœ‰ç«™ç‚¹ä½¿ç”¨HTTPSï¼Œåªè¦åœ¨é…ç½®ä¸­æä¾›äº†ä¸»æœºåã€‚æœ¬æ•™ç¨‹å‡è®¾ä½ å¸Œæœ›é€šè¿‡HTTPSè·å¾—ä¸€ä¸ªå…¬å…±ä¿¡ä»»çš„ç«™ç‚¹ï¼ˆå³ä¸æ˜¯â€œlocalhostâ€ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬å°†ä½¿ç”¨å…¬å…±åŸŸåå’Œå¤–éƒ¨ç«¯å£ã€‚
{: .prompt-tip}
å…ˆå†³æ¡ä»¶ï¼š
- åŸºæœ¬çš„ç»ˆç«¯/å‘½ä»¤è¡ŒæŠ€èƒ½
- å¯¹DNSçš„åŸºæœ¬äº†è§£
- å·²æ³¨å†Œçš„å…¬å…±åŸŸå
- å¤–éƒ¨è®¿é—®ç«¯å£ 80 å’Œ 443
- PATHå˜é‡ä¸­åŒ…å«caddyå’ŒcurlS

```zsh
curl "https://cloudflare-dns.com/dns-query?name=example.com&type=A" \
  -H "accept: application/dns-json"
```
{: file="â—ï¸â—ï¸â—ï¸æ³¨æ„æ›¿æ¢å‘½ä»¤ä¸­çš„example.comâ—ï¸â—ï¸â—ï¸"}

# Systemctlåå°è¿è¡Œ
caddyé»˜è®¤è·¯å¾„åœ¨`/lib/systemd/system/caddy.service`
```zsh
# caddy.service
#
# For using Caddy with a config file.
#
# Make sure the ExecStart and ExecReload commands are correct
# for your installation.
#
# See https://caddyserver.com/docs/install for instructions.
#
# WARNING: This service does not use the --resume flag, so if you
# use the API to make changes, they will be overwritten by the
# Caddyfile next time the service is restarted. If you intend to
# use Caddy's API to configure it, add the --resume flag to the
# `caddy run` command or use the caddy-api.service file instead.

[Unit]
Description=Caddy
Documentation=https://caddyserver.com/docs/
After=network.target network-online.target
Requires=network-online.target

[Service]
Type=notify
User=caddy # å¦‚æœé‡åˆ°æƒé™ä¸å¤Ÿæ— æ³•è®¿é—®çš„é—®é¢˜ï¼ŒæŠŠè¿™é‡Œæ”¹æˆroot
Group=caddy # å¦‚æœé‡åˆ°æƒé™ä¸å¤Ÿæ— æ³•è®¿é—®çš„é—®é¢˜ï¼ŒæŠŠè¿™é‡Œæ”¹æˆroot
ExecStart=/usr/bin/caddy run --environ --config /etc/caddy/Caddyfile
ExecReload=/usr/bin/caddy reload --config /etc/caddy/Caddyfile --force
TimeoutStopSec=5s
LimitNOFILE=1048576
LimitNPROC=512
PrivateTmp=true
ProtectSystem=full
AmbientCapabilities=CAP_NET_ADMIN CAP_NET_BIND_SERVICE

[Install]
WantedBy=multi-user.target
```
{: file="é»˜è®¤é…ç½®"}